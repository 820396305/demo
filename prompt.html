<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>弹框</title>
    <script src="static/js/jquery-2.1.1.min.js"></script>
    
    <style>

        .button{
    width: 98px;
    height: 16px;
    border: 1px solid #D6D6D6;
}
        /*prompt*/
        .layer{position:fixed;left:0;top:0;background:rgba(0,0,0,0.3);width:100%;height:100%;z-index:100;}
        .popup{min-width:300px;border:1px solid #9EBEE5;background:#fff;z-index:11;position:fixed;left:50%;top:50%;padding:2px;}
        .popup .title{width:100%;height:26px;line-height:26px;text-indent:0.8em;color:white;background:rgb(72,148,213);cursor:move;}
        .popup .close{background:url(/theme/static/images/window_close.png) left top no-repeat;width:15px;height:15px;margin:5px 7px 0 0;}
        .popup .buttons div{margin:5px 10px;}
        .popup .main{padding:0px;min-height:20px;overflow-y:auto;overflow-x:hidden;}
        .popup .close{cursor:pointer;}
        .popup .content{padding:15px;}
        .popup .buttons{margin:10px 0px 16px 0;}
        .popup .buttons .button{margin:0 8px 0 15px;text-align:center;cursor:pointer;}
    </style>

    <script>
                /*========== prompt window =========*/
        (function () {
            var index = 1;      //弹出层索引 主要用于标志Id
            var showindex = 0;  //主要用于 弹出层z-index

            //默认
            var defaultOptions = {
                title: "",
                html: "",
                url: "",
                buttons: []
            }
            function prompt(options) {
                if (typeof options == "object") {
                    options = $.extend(defaultOptions, options);
                } else {
                    options = {
                        title: arguments[0].toString(),
                        html: arguments[1].toString(),
                        buttons: arguments[2] || []
                    }
                }
                //----以上将参数均转换成统一对象形式---
                var p = new popup(options);
                return p;
            }

            function promptPage(title, url) {
                var options = {
                    title: title.toString(),
                    url: url,
                    buttons: arguments[2] || [],
                    width: arguments[3] || 600,
                    height: arguments[4] || 400
                }
                //----以上将参数均转换成统一对象形式---

                var p = new popup(options);
                return p;
            }

            //
            function popup(options) {
                var popupDom = null;
                var exeConfirm, exeSave, exeDelete, exeCancel, exeClose;
                this.onClose = function (callback) { exeClose = callback; };
                this.onConfirm = function (callback) { exeConfirm = callback; };
                this.onCancel = function (callback) { exeCancel = callback; };
                this.onSave = function (callback) { exeSave = callback; };
                this.onDelete = function (callback) { exeDelete = callback; };

                var self = this;
                //显示
                this.show = function () {
                    popupDom.parents(".popup-box").show();
                    popupDom.siblings(".layer").css("z-index", 1000 + showindex);
                    popupDom.css("z-index", 1001 + showindex);
                    showindex += 2;
                }
                //隐藏
                this.hide = function () {
                    popupDom.parents(".popup-box").hide();
                }
                //关闭
                this.close = function () {
                    if (typeof (exeClose) == "function") exeClose();
                    popupDom.parents(".popup-box").remove();
                    index--;
                }
                this.resize = function(){
                    autosize(popupDom)
                }
                //创建一个新窗体
                var create = function () {
                    var html = '<div class="popup-box"><div class="layer"></div><div class="popup" id="popup_' + index + '"><div class="title"><div class="name fl">';
                    html += options.title;
                    html += '</div><div class="close fr"></div></div><div class="main">';
                    if (options.html != null && options.html != "") {
                        html += '<div class="content">' + options.html + '</div>';
                    } else if (options.url != null && options.url != "") {
                        var width = options.width || 600;
                        var height = options.height || 400;
                        html += '<iframe src="' + options.url + '" width="' + width + '" height="' + height + '" style="border:0;" ></iframe>';
                    } else {

                    }
                    html += '</div>';
                    if (options.buttons && options.buttons instanceof Array && options.buttons.length > 0) {
                        html += '<div class="buttons box">';
                        for (var i = 0; i < options.buttons.length; i++) {
                            if (options.buttons[i] == "confirm") {
                                html += '<div class="button confirm inline">确认</div>';
                            } else if (options.buttons[i] == "save") {
                                html += '<div class="button save inline">保存</div>';
                            } else if (options.buttons[i] == "cancel") {
                                html += '<div class="button cancel inline">取消</div>';
                            } else if (options.buttons[i] == "delete") {
                                html += '<div class="button delete inline">删除</div>';
                            }
                        }
                        html += '</div>';
                    }
                    html += '</div></div>';

                    $("body").append(html);
                    popupDom = $("#popup_" + index);
                    //居中
                    popupDom.css("width",popupDom.width()+20);
                    autosize(popupDom);
                    //顶层
                    $("#popup_" + index).siblings(".layer").css("z-index", 1000 + showindex);
                    $("#popup_" + index).css("z-index", 1001 + showindex);

                    //绑定
                    bindEventListener(popupDom);
                    $(window).bind('resize',function(){
                       autosize(popupDom);
                    });
                    index++; showindex += 2;
                    new window.UI.drag('#popup_'+(index-1)+' .title','#popup_'+(index-1));
                }
                function autosize(dom){
                    var CHeight = document.documentElement.clientHeight,
                        CWidth = document.documentElement.clientWidth,
                        PHeight = dom.height(),PWidth = dom.width();
                    dom.find(".main").css("max-height",CHeight - 75);
                    dom.css('top',CHeight>PHeight?(CHeight-PHeight)/2:10);
                    dom.css('left',(CWidth-PWidth)/2);
                }

                //返回窗体里面内容对象
                this.content = function () {
                    if (popupDom.find(".content").length != 0) {
                        return popupDom.find(".content");
                    }
                    return null;
                }
                //绑定各种事件
                var bindEventListener = function (popdom) {
                    popdom.undelegate(".close", "click");
                    popdom.delegate(".close", "click", function () {
                        //self.hide();      //多窗口，重叠问题
                        self.close();
                    });
                    $(document).undelegate("body", "keydown");
                    $(document).delegate("body", "keydown", function (e) {
                        if (e.keyCode == 27) {      //按下 ESC 键
                            if (index - 1 >= 1) {
                                var topPopup = null, maxindex = -1;
                                $(".popup").each(function () {
                                    if ($(this).parents(".popup-box").css("display") != "none") {
                                        topPopup = $(this).css("z-index") > maxindex ? $(this) : topPopup;
                                    }
                                });
                                if (topPopup != null) { topPopup.find(".close").trigger("click"); }
                            }

                        }
                    });
                    popdom.undelegate(".confirm,.save,.delete,.cancel", "click");
                    popdom.delegate(".confirm", "click", function () { if (typeof exeConfirm == "function") { exeConfirm(); } });
                    popdom.delegate(".save", "click", function () { if (typeof exeSave == "function") { exeSave(); } });
                    popdom.delegate(".delete", "click", function () { if (typeof exeDelete == "function") { exeDelete(); } });
                    popdom.delegate(".cancel", "click", function () { if (typeof exeCancel == "function") { exeCancel(); } });
                };

                create(); //new 对象后创建窗体
            }

            window.UI = $.extend(window.UI, { prompt: prompt, promptPage: promptPage });
        })();

        (function(){
            function drag(id,moveBox){
                var box = $(id)[0];
                var moveBox = $(moveBox)[0];
                
                box.onmousedown = function(e){
                    var disX=e.clientX-moveBox.offsetLeft;
                    var disY=e.clientY-moveBox.offsetTop;
                    document.onmousemove = function(e){
                        e.preventDefault();
                        var l=e.clientX-disX;
                        var t=e.clientY-disY;
                        if(l<0){
                            l=0;
                        }else if(l>document.documentElement.clientWidth-moveBox.offsetWidth){
                            l = document.documentElement.clientWidth-moveBox.offsetWidth;
                        }
                        if(t<0){
                            t=0;
                        }else if(t>document.documentElement.clientHeight-moveBox.offsetHeight){
                            t = document.documentElement.clientHeight-moveBox.offsetHeight;
                        }
        
                        moveBox.style.margin = "0";
                        moveBox.style.left=l+'px';
                        moveBox.style.top=t+'px';
                        return false;
                    }
                    document.onmouseup = function(){
                        document.onmousemove = null;    
                        document.onmouseup = null;
                        return false;
                    }
                    return false;
                }
            }
            window.UI = $.extend(window.UI, { drag:drag });
        })();

    </script>
</head>
<body>
    
</body>
    
    <button id="btn1">弹框</button>


    <button id="btn2">iframe 百度</button>

    <script>
        //--------------以下实例测试------------
       var option = {
            title: "helloworld",
            //html:"<h1>this is a box</h1>",
            url: "http://www.baidu.com",
            buttons: ["confirm", "cancle", "save", "delete"],
            width: 800,
            height: 500
        }

        $("#btn1").click(function () {
            textBox = window.UI.prompt("小明", "<h1>Good Afternoon</h1>", ["confirm"]);
            console.info(textBox);
            textBox.onConfirm(function () {
                alert("您点击了确认按钮，会调用close方法退出");
                textBox.close();
            });
            textBox.onClose(function(){
                alert("文本窗口关闭");    
            });
        });

        $("#btn2").click(function () {
            textBox = window.UI.prompt(option);
            textBox.onConfirm(function () {
                alert("点击了确定，隐藏,3s后出来");
                textBox.hide();
                setTimeout(function(){textBox.show();},3000);
            });
        });
    </script>
</html>